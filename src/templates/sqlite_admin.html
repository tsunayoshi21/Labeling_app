<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administraci√≥n</title>
    <link rel="icon" href="{{ url_for('static', filename='icons/ocr-icon-square-gradient.svg') }}" type="image/svg+xml" media="(prefers-color-scheme: light)">
    <link rel="icon" href="{{ url_for('static', filename='icons/ocr-icon-dark.svg') }}" type="image/svg+xml" media="(prefers-color-scheme: dark)">
    <link rel="icon" href="{{ url_for('static', filename='icons/ocr-icon-square-gradient.svg') }}" type="image/svg+xml">
    <!-- Critical CSS inline -->
    <style>
      :root{--color-bg-gradient-start:#667eea;--color-bg-gradient-end:#764ba2;--color-bg-app:#f5f7fa;--color-primary:#667eea;--color-primary-alt:#764ba2;--color-light:#f8f9fa;--color-border:#e1e5e9;--font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;--footer-height:64px}
      *{box-sizing:border-box;margin:0;padding:0}
      body{background:var(--color-bg-app);font-family:var(--font-family);min-height:100vh;display:flex;flex-direction:column;padding-bottom:var(--footer-height)}
      .header{background:linear-gradient(135deg,var(--color-bg-gradient-start),var(--color-bg-gradient-end));color:#fff;padding:1rem 2rem;display:flex;justify-content:space-between;align-items:center;box-shadow:0 2px 10px rgba(0,0,0,.12)}
      .header h1{font-size:1.2rem;margin:0;font-weight:600;letter-spacing:-.5px}
      .nav-tabs{display:flex;gap:1rem;margin:1.2rem 2rem 0}
      .nav-tab{padding:.55rem 1rem;background:#fff;border:0;border-radius:5px 5px 0 0;cursor:pointer;font-weight:500;font-size:.8rem;box-shadow:0 2px 4px rgba(0,0,0,.08)}
      .nav-tab.active{background:var(--color-primary);color:#fff}
      .container{max-width:1400px;margin:0 auto;padding:1.25rem 1.5rem;flex:1}
      body.preload *{transition:none!important;animation:none!important}
      /* Footer */
      .app-footer{position:fixed;left:0;right:0;bottom:0;min-height:var(--footer-height);padding:.75rem 1rem;background:linear-gradient(135deg,#4f6eea,#5a67d8);color:#fff;font-size:.85rem;text-align:center;box-shadow:0 -6px 14px rgba(0,0,0,.08);z-index:1000}
    </style>
    <!-- Preload bundled CSS -->
    <link rel="preload" href="{{ url_for('static', filename='css/admin.bundle.css') }}" as="style" onload="this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="{{ url_for('static', filename='css/admin.bundle.css') }}"></noscript>
    <!-- Nuevo: estilos modulares adicionales -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin_mod.css') }}">
</head>
<body class="admin-view preload">
    <div class="header">
        <h1>üõ†Ô∏è Panel de Administraci√≥n</h1>
        <div class="user-info">
            <span id="admin-name">Admin</span>
            <button class="btn btn-primary" data-action="go-annotator" style="margin-right: 1rem;">
                üìù Ir a Anotar
            </button>
            <button class="btn btn-danger" data-action="logout">Cerrar Sesi√≥n</button>
        </div>
    </div>
    
    <div class="nav-tabs" role="tablist">
        <button class="nav-tab active" data-tab="overview" aria-selected="true">Resumen</button>
        <button class="nav-tab" data-tab="assignments" aria-selected="false">Asignaciones</button>
        <button class="nav-tab" data-tab="users" aria-selected="false">Usuarios</button>
        <button class="nav-tab" data-tab="quality" aria-selected="false">Control de Calidad</button>
    </div>
    
    <div class="container">
        <div id="overview-tab" class="tab-content active" aria-hidden="false">
            <h2>Estad√≠sticas Generales</h2>
            <div class="stats-grid" id="general-stats"></div>
            <div class="section-header">
                <h3>Actividad Reciente</h3>
                <button class="btn btn-primary" data-action="export-database" style="display: flex; align-items: center; gap: 0.5rem;">
                    <span>üì•</span>
                    <span>Exportar Base de Datos</span>
                </button>
            </div>
            <div id="recent-activity"></div>
        </div>
        <div id="assignments-tab" class="tab-content" aria-hidden="true">
            <div class="section-header"><h2>Asignar Tareas</h2></div>
            <div class="assignment-card assignment-card--elevated" aria-label="Asignaci√≥n Autom√°tica de Im√°genes">
                <div class="assignment-card__accent" aria-hidden="true"></div>
                <div class="assignment-card__header"><h3>üéØ Asignaci√≥n Autom√°tica</h3><p class="assignment-card__desc">Distribuye r√°pidamente im√°genes a un usuario priorizando seg√∫n su estado actual. Los conteos se actualizan al crear nuevas asignaciones.</p></div>
                <form class="auto-assignment-form" onsubmit="return false;">
                    <div class="form-group"><label for="auto-user-select">Usuario</label><select id="auto-user-select"><option value="">Seleccionar usuario...</option></select></div>
                    <div class="form-group"><label for="auto-count">N¬∫ Im√°genes</label><input type="number" id="auto-count" min="1" max="50000" value="1000"></div>
                    <fieldset class="form-group priority-group" role="radiogroup" aria-label="Prioridad de selecci√≥n">
                        <label class="priority-option"><input type="radio" name="priority" value="unannotated" checked> <span>Priorizar sin anotar</span></label>
                        <label class="priority-option"><input type="radio" name="priority" value="annotated"> <span>Priorizar anotadas admin</span></label>
                    </fieldset>
                    <div class="form-actions"><button class="btn btn-success btn-lg" data-action="assign-auto">üöÄ Asignar</button></div>
                </form>
                <div class="assignment-stats-inline" aria-label="Resumen r√°pido de im√°genes">
                    <div class="a-stat" title="Im√°genes totales"><span class="a-stat__label">Total</span><span id="a-total" class="a-stat__value">-</span></div>
                    <div class="a-stat" title="Im√°genes sin anotar"><span class="a-stat__label">Sin anotar</span><span id="a-unannotated" class="a-stat__value">-</span></div>
                    <div class="a-stat" title="Progreso global"><span class="a-stat__label">Progreso</span><span id="a-progress" class="a-stat__value">-</span></div>
                </div>
                <p class="assignment-hint">Tip: Ajusta el n√∫mero en funci√≥n de la carga de trabajo y usa la prioridad para acelerar √°reas espec√≠ficas. Esta operaci√≥n evita reasignar im√°genes ya trabajadas.</p>
                <div id="auto-assignment-result" class="assignment-result" aria-live="polite"></div>
            </div>
        </div>
        <div id="users-tab" class="tab-content" aria-hidden="true">
            <div class="section-header"><h2>Gesti√≥n de Usuarios</h2><button class="btn btn-primary" data-action="open-create-user">+ Crear Usuario</button></div>
            <div class="user-management-toolbar">
                <div class="user-counters" role="group" aria-label="Resumen de usuarios">
                    <span class="counter-pill">Total <strong id="user-count-total">0</strong></span>
                    <span class="counter-pill">Anotadores <strong id="user-count-annotators">0</strong></span>
                    <span class="counter-pill">Admins <strong id="user-count-admins">0</strong></span>
                </div>
                <div class="user-filters" role="group" aria-label="Filtros de rol">
                    <button type="button" class="filter-chip active" data-filter-role="all">Todos</button>
                    <button type="button" class="filter-chip" data-filter-role="annotator">Anotadores</button>
                    <button type="button" class="filter-chip" data-filter-role="admin">Admins</button>
                </div>
                <div class="user-search"><input id="user-search" type="text" placeholder="üîç Buscar usuario..." aria-label="Buscar usuario"></div>
            </div>
            <table class="table users-table-modern" id="users-table"><thead><tr>
                <th scope="col" data-sort="id">ID</th>
                <th scope="col" data-sort="username">Usuario</th>
                <th scope="col">Rol</th>
                <th scope="col" data-sort="agreement">Agreement c/ Admin</th>
                <th scope="col" data-sort="comparisons">Comparaciones</th>
                <th scope="col">Acciones</th>
            </tr></thead><tbody></tbody></table>
        </div>
                <div id="quality-tab" class="tab-content" aria-hidden="true">
                                    <div class="section-header">
                                        <h2>üîç Control de Calidad</h2>
                                        <div class="qc-filter">
                                            <label class="qc-filter__label" for="quality-user-filter">Usuario</label>
                                            <div class="qc-filter__control">
                                                <select id="quality-user-filter" aria-label="Filtrar por usuario para control de calidad" disabled>
                                                    <option value="all">Todos (0)</option>
                                                </select>
                                            </div>
                                            <button class="btn btn-primary qc-filter__refresh" data-action="quality-refresh">üîÑ Actualizar</button>
                                        </div>
                                    </div>
            <div style="background:#e8f4f8;padding:1rem;border-radius:8px;margin-bottom:2rem;border-left:4px solid #17a2b8;">
                <h4 style="margin:0 0 .5rem;color:#0c5460;">‚ÑπÔ∏è ¬øQu√© es el Control de Calidad?</h4>
                <p style="margin:0;color:#0c5460;">Esta vista muestra las im√°genes donde las anotaciones del admin difieren de las anotaciones de los usuarios. Permite revisar y consolidar las diferencias.</p>
            </div>
            <div id="quality-control-list"><div style="text-align:center;padding:3rem;color:#666;"><div style="font-size:3rem;margin-bottom:1rem;">‚è≥</div><p>Cargando datos de control de calidad...</p></div></div>
        </div>
    </div>
    <footer class="app-footer" role="contentinfo">¬© 2025 ¬∑ Panel de Administraci√≥n ¬∑ Corrector de Transcripciones OCR ¬∑ Cristobal Vasquez</footer>
    <script>window.addEventListener('load',()=>document.body.classList.remove('preload'));</script>
    <script type="module" src="{{ url_for('static', filename='js/views/admin.js') }}"></script>
</body>
</html>
