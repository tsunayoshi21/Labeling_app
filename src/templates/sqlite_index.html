<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Corrector de Transcripciones OCR - Colaborativo</title>
    <!-- Critical (minimal) CSS inline to avoid FOUC -->
    <style>
      :root{--font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;--color-bg-gradient-start:#667eea;--color-bg-gradient-end:#764ba2;--color-primary:#667eea;--color-success:#28a745;--color-light:#f8f9fa;--color-text:#333;}
      *{box-sizing:border-box;margin:0;padding:0}
      body{font-family:var(--font-family);background:linear-gradient(135deg,var(--color-bg-gradient-start) 0%,var(--color-bg-gradient-end) 100%);min-height:100vh;padding:15px;}
      body.preload *{transition:none!important;animation:none!important}
      .container{background:#fff;border-radius:20px;box-shadow:0 10px 30px rgba(0,0,0,.12);padding:20px;max-width:1200px;margin:0 auto;min-height:calc(100vh - 30px);display:flex;flex-direction:column}
      .header{display:flex;justify-content:space-between;align-items:center;background:linear-gradient(135deg,var(--color-bg-gradient-start),var(--color-bg-gradient-end));color:#fff;padding:1rem 1.2rem;border-radius:14px;margin-bottom:15px}
      .header h1{font-size:1.2rem;font-weight:600;margin:0;letter-spacing:-.5px}
    </style>
    <!-- Preload bundled CSS -->
    <link rel="preload" href="{{ url_for('static', filename='css/annotator.bundle.css') }}" as="style" onload="this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="{{ url_for('static', filename='css/annotator.bundle.css') }}"></noscript>
</head>
<body class="annotator-view preload">
    <div class="container">
        <div class="header">
            <h1>üìù Corrector de Transcripciones OCR - Colaborativo</h1>
            <div class="user-info">
                <span id="user-name">Cargando...</span>
                <button class="logout-btn" id="logoutBtn">Cerrar Sesi√≥n</button>
            </div>
        </div>

        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar" style="width: 0%;">0%</div>
            </div>
            <div class="stats">
                <div class="stat">
                    <div class="stat-number" id="totalTasks">-</div>
                    <div class="stat-label">Total</div>
                </div>
                <div class="stat">
                    <div class="stat-number" id="pendingTasks">-</div>
                    <div class="stat-label">Pendientes</div>
                </div>
                <div class="stat">
                    <div class="stat-number" id="correctedTasks">-</div>
                    <div class="stat-label">Corregidas</div>
                </div>
                <div class="stat">
                    <div class="stat-number" id="approvedTasks">-</div>
                    <div class="stat-label">Aprobadas</div>
                </div>
                <div class="stat">
                    <div class="stat-number" id="discardedTasks">-</div>
                    <div class="stat-label">Descartadas</div>
                </div>
            </div>
        </div>

        <div class="main-content">
            <div id="loadingDiv" class="loading">
                <div class="spinner"></div>
            </div>

            <div id="workArea" class="hidden">
                <!-- Layout principal optimizado -->
                <div class="main-work-area">
                    <!-- √Årea central con imagen y controles -->
                    <div class="central-area">
                        <!-- Overlay din√°mico de zoom -->
                        <div id="zoomOverlay">100%</div>
                        <!-- ID de imagen actual y navegaci√≥n -->
                        <div class="image-header">
                            <div class="image-info">
                                <span class="image-id">Imagen ID: <strong id="currentImageId">-</strong></span>
                                <div class="navigation-controls">
                                    <button id="prevBtn" class="btn btn-nav" title="Tarea anterior">
                                        ‚Üê Anterior <span class="hotkey">‚Üê</span>
                                    </button>
                                    <button id="nextBtn" class="btn btn-nav" title="Siguiente tarea">
                                        Siguiente ‚Üí <span class="hotkey">‚Üí</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <!-- NUEVO: Controles de zoom -->
                        <div class="zoom-controls" aria-label="Controles de zoom">
                            <button id="zoomOutBtn" title="Alejar (-)">‚àí</button>
                            <span id="zoomDisplay">100%</span>
                            <button id="zoomInBtn" title="Acercar (+)">+</button>
                            <button id="zoomResetBtn" title="Reset (0)">‚ü≥</button>
                        </div>
                        <!-- Imagen -->
                        <div class="image-container">
                            <img id="currentImage" class="current-image hidden" alt="Imagen actual">
                            <div id="noImageMessage" class="hidden">
                                <h3>‚ö†Ô∏è Imagen no encontrada</h3>
                                <p>La imagen no existe en la carpeta especificada</p>
                            </div>
                        </div>

                        <!-- Transcripci√≥n -->
                        <div class="transcription-container">
                            <div class="transcription-label">Transcripci√≥n actual:</div>
                            <div id="transcriptionDisplay" class="transcription-text"></div>
                            <input type="text" id="editInput" class="edit-input hidden" placeholder="Ingresa la transcripci√≥n correcta...">
                        </div>

                        <!-- Acciones principales -->
                        <div class="actions">
                            <button id="correctBtn" class="btn btn-correct">
                                ‚úì Correcta <span class="hotkey">1</span>
                            </button>
                            <button id="editBtn" class="btn btn-edit">
                                ‚úèÔ∏è Editar <span class="hotkey">2</span>
                            </button>
                            <button id="discardBtn" class="btn btn-discard">
                                üóëÔ∏è Descartar <span class="hotkey">3</span>
                            </button>
                            <button id="saveEditBtn" class="btn btn-save hidden">üíæ Guardar</button>
                            <button id="cancelBtn" class="btn btn-cancel hidden">‚úñÔ∏è Cancelar</button>
                        </div>
                        <!-- Hotkeys inline (solo m√≥viles / pantallas angostas) -->
                        <div class="hotkeys-inline" aria-label="Atajos de teclado">
                            <div class="hk"><kbd>1</kbd>/<kbd>Esp</kbd><br>OK</div>
                            <div class="hk"><kbd>2</kbd>/<kbd>E</kbd><br>Editar</div>
                            <div class="hk"><kbd>3</kbd>/<kbd>Del</kbd><br>Descartar</div>
                            <div class="hk"><kbd>‚Üê</kbd><br>Ant</div>
                            <div class="hk"><kbd>‚Üí</kbd><br>Sig</div>
                            <!-- Consolidado zoom +/- sin tecla '=' -->
                            <div class="hk"><kbd>+</kbd> <kbd>‚àí</kbd><br>Zoom +/-</div>
                            <div class="hk"><kbd>0</kbd><br>Reset</div>
                            <div class="hk"><kbd>Ctrl</kbd>+<kbd>Wheel</kbd><br>Zoom</div>
                        </div>
                        <!-- Pending inline cuando se ocultan paneles laterales -->
                        <div class="pending-inline">
                            <h6>üìã Pr√≥ximas</h6>
                            <div id="pendingTasksPreview" class="pending-list"></div>
                        </div>
                    </div>
                    <!-- Hotkeys en los laterales (desktop) -->
                    <div class="hotkeys-lateral left-hotkeys">
                        <h6>‚å®Ô∏è Acciones</h6>
                        <div class="hotkey-compact"><kbd>1</kbd> / <kbd>Espacio</kbd><br>Correcta</div>
                        <div class="hotkey-compact"><kbd>2</kbd> / <kbd>E</kbd><br>Editar</div>
                        <div class="hotkey-compact"><kbd>3</kbd> / <kbd>Del</kbd><br>Descartar</div>
                        <div class="hotkey-compact"><kbd>‚Üê</kbd><br>Anterior</div>
                        <div class="hotkey-compact"><kbd>‚Üí</kbd><br>Siguiente</div>
                    </div>
                    <div class="hotkeys-lateral right-hotkeys">
                        <h6>‚å®Ô∏è Extras</h6>
                        <div class="hotkey-compact"><kbd>Enter</kbd><br>Confirmar</div>
                        <div class="hotkey-compact"><kbd>Esc</kbd><br>Cancelar</div>
                        <div class="hotkey-compact"><kbd>+</kbd> <kbd>‚àí</kbd><br>Zoom +/-</div>
                        <div class="hotkey-compact"><kbd>0</kbd><br>Reset Zoom</div>
                        <div class="hotkey-compact"><kbd>Ctrl</kbd>+Wheel<br>Zoom</div>
                        <div class="hotkey-compact"><kbd>L</kbd><br>Cerrar Sesi√≥n</div>
                        <!-- (Pending preview movido al centro para responsive) -->
                    </div>
                </div>
            </div>

            <div id="completionDiv" class="hidden">
                <div class="completion-message">
                    <h2>üéâ ¬°Excelente trabajo!</h2>
                    <p>No tienes m√°s tareas pendientes por el momento.</p>
                    <div class="no-tasks-actions">
                        <button class="btn btn-edit" id="reloadBtn">üîÑ Buscar m√°s tareas</button>
                        <button class="btn btn-cancel" id="logoutBtn2">üö™ Cerrar sesi√≥n</button>
                    </div>
                </div>
            </div>

            <div id="errorDiv" class="error hidden"></div>
        </div>
    </div>
    <script>window.addEventListener('load',()=>document.body.classList.remove('preload'));</script>
    <!-- New ES Module entrypoint -->
    <script type="module" src="{{ url_for('static', filename='js/views/annotator.js') }}"></script>
</body>
</html>
